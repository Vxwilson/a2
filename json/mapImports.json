{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",

  "title": {
      "text": "Who's Drinking It?"
    },
    "width": 580,
    "height": 350,
    "data": {
      "url": "https://raw.githubusercontent.com/FIT3179/Vega-Lite/main/3_choropleth_map/js/ne_110m_admin_0_countries.topojson",
      "format": {
        "type": "topojson",
        "feature": "ne_110m_admin_0_countries"
      }
    },
    "projection": {
      "type": "equalEarth"
    },
    "layer": [
      {
        "data": {
          "graticule": true
        },
        "mark": {
          "type": "geoshape",
          "stroke": "lightgray",
          "strokeWidth": 0.5
        }
      },
      {
        "transform": [
          {
            "calculate": "'No available data'",
            "as": "Note"
          }
        ],
        "mark": {
          "type": "geoshape",
          "fill": "lightgray",
          "stroke": "white"
        },
        "encoding": {
          "tooltip": [
            {
              "field": "properties.NAME",
              "type": "nominal",
              "title": "Country"
            },
            {
              "field": "Note",
              "type": "nominal"
            }
          ]
        }
      },
      {
        "transform": [
          {
            "lookup": "properties.NAME",
            "from": {
              "data": {
                "url": "data/imports.csv"
              },
              "key": "imports",
              "fields": [
                "1990",
                "1991",
                "1992",
                "1993",
                "1994",
                "1995",
                "1996",
                "1997",
                "1998",
                "1999",
                "2000",
                "2001",
                "2002",
                "2003",
                "2004",
                "2005",
                "2006",
                "2007",
                "2008",
                "2009",
                "2010",
                "2011",
                "2012",
                "2013",
                "2014",
                "2015",
                "2016",
                "2017",
                "2018"
              ]
            }
          },
          {
            "calculate": "datum[yearSelection]",
            "as": "Count"
          },
          {
            "calculate": "format(datum[yearSelection] * 1000 / 1000000, '.3f') + ' million bags (60-kg) of coffee.'",
            "as": "importtooltip"
          }
        ],
        "mark": {
          "type": "geoshape",
          "cursor": "pointer",
          "stroke": "#1932c8",
          "strokeWidth": 0.5
        },
        "encoding": {
          "color": {
            "field": "Count",
            "type": "quantitative",
            "scale": {
              "domain": [0, 0.001, 100, 500, 2000, 6000, 10000, 25000],
              "range": [
                "#ffffff00",
                "#8279a5",
                "#a57ca5",
                "#cc86a4",
                "#ec939c",
                "#ffa78f",
                "#ffc184",
                "#ffdf84"
              ]
            },
            "legend": {
              "title": "Imports (thousand 60kg bags)",
              "disable": true
            }
          },
          "tooltip": [
            {
              "field": "properties.NAME",
              "type": "nominal",
              "title": "Country"
            },
            {
              "field": "importtooltip",
              "title": "imports"
            }
          ]
        }
      }
    ]
  }